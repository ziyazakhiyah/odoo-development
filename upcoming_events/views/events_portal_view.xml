<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_my_home_events" inherit_id="portal.portal_my_home" name="Upcoming Events">
        <xpath expr="//div[@id='portal_vendor_category']" position="inside">
            <div class="o_portal_index_card col-md-6 order-2">
                <a href="/my/events" title="Upcoming Events"
                   class="d-flex gap-2 gap-md-3 py-3 pe-2 px-md-3 h-100 rounded text-decoration-none bg-100">
                    <div class="o_portal_icon d-block align-self-start">
                        <img src="/upcoming_events/static/src/img/event.svg" loading="lazy" class="img-fluid"
                             style="width: 48px; height: 48px;"/>
                    </div>
                    <div class="">
                        <div class="mt-0 mb-1 fs-5 fw-normal lh-1 d-flex gap-2">
                            <span>Upcoming Events</span>
                        </div>
                        <div class="opacity-75">
                            Follow the upcoming events
                        </div>
                    </div>
                </a>
            </div>
        </xpath>
    </template>

    <template id="portal_searchbar_event_type" inherit_id="portal.portal_searchbar">
        <xpath expr="//button[@id='portal_searchbar_filters']/following-sibling::div" position="inside">
            <t t-if="event_type_selection">
                <hr class="dropdown-divider"/>
                <t t-foreach="event_type_selection.items()" t-as="etype">
                    <a t-att-href="default_url + '?' + keep_query('*', filterby='type', event_type=etype[0])"
                       t-attf-class="dropdown-item#{filterby == 'type' and event_type == etype[0] and ' active' or ''}">
                        Type: <t t-esc="etype[1]"/>
                    </a>
                </t>
            </t>
        </xpath>
    </template>

    <template id="my_portal_breadcrumbs" inherit_id="portal.portal_breadcrumbs" name="Breadcrumb Extension">
        <xpath expr="//ol" position="inside">
            <li t-if="page_name == 'upcoming_events'" class="breadcrumb-item">Upcoming Events</li>
        </xpath>
    </template>

    <template id="portal_events" name="Upcoming Events">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title" t-value="'Upcoming Events'"/>
                <t t-set="default_url" t-value="'/my/events'"/>
                <t t-set="searchbar_sortings" t-value="searchbar_sortings"/>
                <t t-set="searchbar_filters" t-value="searchbar_filters"/>
                <t t-set="searchbar_groupby" t-value="searchbar_groupby"/>
                <t t-set="sortby" t-value="sortby"/>
                <t t-set="filterby" t-value="filterby"/>
                <t t-set="breadcrumbs_searchbar" t-value="breadcrumbs_searchbar"/>
                <t t-set="page_name" t-value="'upcoming_events'"/>
            </t>
            <section class="s_title">
                <div class="container">
                    <h1>Upcoming Events</h1>
                </div>
                <br/>
            </section>
            <t t-if="not events">
                <p class="alert alert-warning">There are currently no upcoming events.</p>
            </t>
            <t t-if="events">
                <div class="accordion" id="eventAccordion">
                    <t t-foreach="events" t-as="event">
                        <div class="accordion-item">
                            <h2 class="accordion-header" t-att-id="'heading-' + str(event.id)">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse"
                                        t-att-data-bs-target="'#collapse-' + str(event.id)">
                                    <div class="d-flex flex-column w-100">
                                        <div class="fw-bold fs-6">
                                            <span t-field="event.event_name"/>
                                            (<span t-field="event.event_type"/>)
                                        </div>
                                        <div class="text-muted mt-1">
                                            <t t-if="event.start_date and event.end_date">
                                                <span t-field="event.start_date"/>
                                                â€”
                                                <span t-field="event.end_date"/>
                                                |
                                            </t>
                                            <span t-field="event.university_id.name"/>
                                        </div>
                                    </div>
                                </button>
                            </h2>
                            <div class="accordion-collapse collapse"
                                 t-att-id="'collapse-' + str(event.id)"
                                 data-bs-parent="#eventAccordion">
                                <div class="accordion-body">
                                    <t t-if="event.event_line_ids">
                                        <table class="table table-sm table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Event</th>
                                                    <th>Start Time</th>
                                                    <th>End Time</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="event.event_line_ids" t-as="line">
                                                    <tr>
                                                        <td>
                                                            <span t-field="line.content"/>
                                                        </td>
                                                        <td>
                                                            <span t-field="line.start_time"/>
                                                        </td>
                                                        <td>
                                                            <span t-field="line.end_time"/>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </t>
                                    <t t-if="not event.event_line_ids">
                                        <p class="text-muted">No activities added for this event.</p>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
        </t>
    </template>
</odoo>