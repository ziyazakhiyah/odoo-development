<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="portal_my_home_contracts" inherit_id="portal.portal_my_home" name="Rent/Lease Contracts">
        <xpath expr="//div[@id='portal_vendor_category']" position="inside">
            <div class="o_portal_index_card col-md-6 order-2">
                <a href="/my/contracts" title="Rent/Lease Contracts"
                   class="d-flex gap-2 gap-md-3 py-3 pe-2 px-md-3 h-100 rounded text-decoration-none bg-100">
                    <div class="o_portal_icon d-block align-self-start">
                        <img src="/property_management/static/src/img/contract.svg" loading="lazy"/>
                    </div>
                    <div class="">
                        <div class="mt-0 mb-1 fs-5 fw-normal lh-1 d-flex gap-2">
                            <span>Rent/Lease Contracts</span>
                        </div>
                        <div class="opacity-75">
                            Follow, download or pay your rent/lease records
                        </div>
                    </div>
                </a>
            </div>
        </xpath>
    </template>

    <template id="portal_contracts" name="Rent/Lease Contracts">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Rent/Lease Contracts</t>
            </t>
            <t t-if="not contracts">
                <p class="alert alert-warning">There are currently no rent/lease records for your account.</p>
            </t>
            <t t-if="contracts" t-call="portal.portal_table">
                <thead>
                    <tr class="active">
                        <th>
                            <span class='d-none d-md-inline'>Rent/Lease Contracts #</span>
                            <span class='d-block d-md-none'>Ref.</span>
                        </th>
                        <th class="text-end">Tenant</th>
                        <th class="text-end">Start Date</th>
                        <th class="text-end">End Date</th>
                        <th class="text-end">Amount</th>
                        <th class="text-end">Status</th>

                    </tr>
                </thead>
                <t t-foreach="contracts" t-as="contract">
                    <tr>
                        <td>
                            <a t-att-href="contract.get_portal_url()">
                                <t t-esc="contract.reference"/>
                            </a>
                        </td>
                        <td class="text-end">
                            <span t-field="contract.tenant_id.name"/>
                        </td>
                        <td class="text-end">
                            <span t-field="contract.start_date" t-options="{'widget': 'date'}"/>
                        </td>
                        <td class="text-end">
                            <span t-field="contract.end_date" t-options="{'widget': 'date'}"/>
                        </td>
                        <td class="text-end">
                            <span t-field="contract.total_amount"/>
                        </td>
                        <td class="text-end">
                            <span t-field="contract.state"/>
                        </td>
                    </tr>
                </t>
            </t>
        </t>
    </template>

    <template id="portal_contract_page" name="Contract Portal View">
        <t t-call="portal.portal_layout">
            <t t-set="badge_class" t-value="'bg-secondary'"/>
            <t t-if="contract.state == 'draft'">
                <t t-set="badge_class" t-value="'bg-primary'"/>
            </t>
            <t t-elif="contract.state == 'confirm'">
                <t t-set="badge_class" t-value="'bg-success'"/>
            </t>
            <t t-elif="contract.state == 'expired'">
                <t t-set="badge_class" t-value="'bg-danger'"/>
            </t>

            <style>
                .status-box {
                position: absolute;
                top: 20px;
                right: 20px;
                padding: 0.75rem 1.5rem;
                border-radius: 0.5rem;
                color: white;
                font-size: 1.25rem;
                font-weight: bold;
                z-index: 10;
                }
                .relative-container {
                position: relative;
                }
            </style>
            <div class="container mt-5 relative-container">
                <div t-attf-class="status-box #{badge_class}">
                    <t t-esc="state_label"/>
                </div>
                <t t-set="breadcrumbs_searchbar" t-value="True"/>
                <div class="breadcrumb mb-4">
                    <a href="/my/home" class="text-muted">
                        <i class="fa fa-home"></i>
                    </a>
                    <span class="mx-2">/</span>
                    <a href="/my/contracts" class="text-muted">My Contracts</a>
                    <span class="mx-2">/</span>
                    <span>Contract</span>
                </div>
                <t t-set="contract" t-value="contract"/>
                <div class="container mt-5">
                    <h3>
                        Contract Reference:
                        <t t-esc="contract.reference"/>
                    </h3>
                </div>
                <br/>
                <p>
                    <strong>Tenant:</strong>
                    <t t-esc="contract.tenant_id.name"/>
                </p>
                <p>
                    <strong>Type of Contract:</strong>
                    <t t-esc="type_label"/>
                </p>
                <p>
                    <strong>Start Date:</strong>
                    <t t-esc="contract.start_date"/>
                </p>
                <p>
                    <strong>End Date:</strong>
                    <t t-esc="contract.end_date"/>
                </p>
                <br/>
                <h5>Properties:</h5>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Property</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="contract.property_line_ids" t-as="line">
                            <tr>
                                <td>
                                    <t t-esc="line.property_id.name"/>
                                </td>
                                <td>
                                    <t t-esc="line.qty"/>
                                </td>
                                <td>
                                    <t t-esc="line.price"/>
                                </td>
                                <td>
                                    <t t-esc="line.subtotal"/>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>

                <p>
                    <strong>Total Amount:</strong>
                    <t t-esc="contract.total_amount"/>
                </p>
            </div>
        </t>
    </template>

</odoo>
